# BOLD-04

## Swap Protocol

...

**The SwapRequest Message (0x0c)**

	**string** id = 1

		Message unique identifier, generated by the sender 


    **uint64** proposed_quantity = 2


    	The proposed quantity


    **string** pair_id = 3


    The trading pair for the swap


    **string** order_id = 4


    	The unique identifier of the maker order

	**string** r_hash = 5

		The taker preimage hash (in hex)

	**uint32** taker_cltv_delta = 6


        The CLTV delta from the current height that should be used to set the timelock for the final hop when sending to taker

This message is sent by the taker to the maker to instantiate the swap negotiation. 

...

**The SwapAccepted Message (0x0d)**

**string** id = 1

		Message unique identifier, generated by the sender 


    **uint64** req_id = 2


    	Link to the id field from the received SwapRequest message

	**string** r_hash = 3


    The taker preimage hash (in hex) from the received SwapRequest message

	**string** quantity = 4

		The accepted quantity (which may be less than the proposed quantity)

	**uint32** maker_cltv_delta = 5


        The CLTV delta from the current height that should be used to set the timelock for the final hop when sending to maker

This message is sent by the maker to the taker to confirm the swap request.

...

**The SwapComplete Message (0x0e)**

	**string** id = 1

		Message unique identifier, generated by the sender 

	**string** r_hash = 3


    The taker preimage hash (in hex)

This message is sent by the taker to the maker to announce the swap successful completion. 

...

**The SwapFailed Message (0x0f)**

	**string** id = 1

		Message unique identifier, generated by the sender 


    **uint64** req_id = 2


        An optional link to the id field from the received SwapRequest message. Otherwise, this field should be empty

	**string** r_hash = 3

		The taker preimage hash (in hex)

	**string **error_message = 4

		Additional information regarding the failure reason

	**uint32 **failure_reason = 5

		The failure reason

This message can be sent by either side of the swap protocol, at any time, to announce the swap termination.

...


<table>
  <tr>
   <td><strong>Failure Reason</strong>
   </td>
   <td><strong>Meaning</strong>
   </td>
   <td><strong>Description</strong>
   </td>
  </tr>
  <tr>
   <td>0x00
   </td>
   <td>Order Not Found
   </td>
   <td>Could not find the order specified by a swap request.
   </td>
  </tr>
  <tr>
   <td>0x01
   </td>
   <td>Order On Hold
   </td>
   <td>The order specified by a swap request is on hold for a different ongoing swap.
   </td>
  </tr>
  <tr>
   <td>0x02
   </td>
   <td>Invalid Swap Request
   </td>
   <td>The swap request contained invalid data
   </td>
  </tr>
  <tr>
   <td>0x03
   </td>
   <td>Swap Client Not Setup
   </td>
   <td>We are not connected to both swap clients, or we are missing public key identifiers for the peer's nodes
   </td>
  </tr>
  <tr>
   <td>0x04
   </td>
   <td>No Route Found
   </td>
   <td>Could not find a route to complete the swap
   </td>
  </tr>
  <tr>
   <td>0x05
   </td>
   <td>Unexpected Client Error
   </td>
   <td>A swap client call failed for an unexpected reason
   </td>
  </tr>
  <tr>
   <td>0x06
   </td>
   <td>Invalid Swap Message Received
   </td>
   <td>Received a swap message with invalid data
   </td>
  </tr>
  <tr>
   <td>0x07
   </td>
   <td>Send Payment Failure
   </td>
   <td> The call to send payment failed
   </td>
  </tr>
  <tr>
   <td>0x08
   </td>
   <td>Invalid Resolve Request
   </td>
   <td>The swap resolver request was invalid
   </td>
  </tr>
  <tr>
   <td>0x09
   </td>
   <td>Payment Hash Reuse
   </td>
   <td>The swap request attempts to reuse a payment hash
   </td>
  </tr>
  <tr>
   <td>0x0a
   </td>
   <td>Swap Timed Out
   </td>
   <td>The swap timed out while we were waiting for it to complete execution
   </td>
  </tr>
  <tr>
   <td>0x0b
   </td>
   <td>Deal Timed Out
   </td>
   <td>The deal timed out while we were waiting for the peer to respond to our swap request
   </td>
  </tr>
  <tr>
   <td>0x0c
   </td>
   <td>Unknown Error
   </td>
   <td>The swap failed due to an unrecognized error
   </td>
  </tr>
</table>


...
