# BOLD #3: Trade Protocol

Order matching systems ('trade engines') of major exchanges differentiate between two participants: the taker and the maker. A maker is someone who submits an order which can't be matched immediately and joins a pool of unmatched orders. A taker on the other hand issues an order which can immediately be matched with an existing (maker) order upon entering the pool. A taker ‘fills’ the order of a maker.

Analogically, we distinguish between two types of participants in a trade on OpenDEX:

* The **Maker**: propagating an order to its peers when it couldn't find a match in the current order book. The order then joins a pool of unmatched orders on all connected peers. 
* The **Taker**: issuing an order which immediately can be matched with an existing (maker) order in the current order book.

In order to sustain the robustness and censorship resistance property of the network, OpenDEX lacks a global order book and a centralized matching engine. Instead, each node on the network maintain its own order book and matching engine. The order book can be limited to a preferred set of trading pairs. In case of a match, the taker order node is expected to instantiate the swap protocol.

###The Order Message (0x06)

    1. string id 
	Message's globally unique identifier, generated by the sender 

	2. Order order
	The carried order 

The `Order` message is used to tell a peer about a new maker order. It should be used only after the order could not be matched locally. 

###The Order Type

	1. string id
	Order's globally unique identifier, generated by the sender 

    2. string pair_id
    A trading pair symbol, constructed with the base currency first, followed by a '/' separator and the quote currency (e.g., “LTC/BTC”)

    3. double price
    The price for the order expressed in units of the quote currency

    4. uint64 quantity
    The number of currently satoshis (or equivalent) for the order

    5. bool is_buy
    Whether the order is a buy (true) or a sell (false)

###The OrderInvalidation Message (0x07)

	1. string id
	Message's globally unique identifier, generated by the sender 

    2. string order_id
    The associated order unique identifier

    3. string pair_id
    The trading pair symbol associated with the order

    4. uint64 quantity
    The number of satoshis (or equivalent) to invalidate from the order sum

The `OrderInvalidation` message is used to tell a peer about the invalidation of an existing order quantity. It will allow the peer to remove the order from his local order book. Order invalidation is a usual event which occurs due to order cancellation or filling (by another order). Failing to update about it will result in the peer having a stale order in his local order book, which he might fill and instantiate a swap procedure which is doomed to fail. In this case, the maker order node reputation is be penalized. 

###The GetOrders Message (0x08)

	1. string id
	Message's globally unique identifier, generated by the sender 

    2. repeated string pair_ids
    The requested orders trading pair symbols, constructed with the base currency first, followed by a  '/' separator and the quote currency (e.g., [“LTC/BTC”, “DAI/BTC”])

The `GetOrders` message is used to query a peer for the list of all his open orders for the specified trading pairs. It should be used to initialize the local order book with a snapshot of the peer's existing open orders. Ongoing new orders are expected to get pushed by the peer via the `Order` message, instead of being queried for. 

###The Orders Message (0x09)

	1. string id
	Message's globally unique identifier, generated by the sender 

    2. string req_id
    Link to the id field from the received GetOrders message

    3. repeated Order orders
    The list of carried orders

The `Orders` message is used to respond to the `GetOrders` message.

